<div class="post-wrapper" *ngIf="post">
  <mat-card class="post-card">
    <div class="post-header-wrapper">
      <div class="post-header">
        <!-- Ø§Ù„ÙŠØ³Ø§Ø±: Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® -->
        <div class="post-info">
          <mat-card-title class="post-title">{{ post.title }}</mat-card-title>
          <mat-card-subtitle class="post-meta">
            <a [routerLink]="['/profile', post.user?.id]" class="author-link">{{ post.user?.name }}</a> Â· 
            <span>{{ post.created_at | date:'medium' }}</span>
            <!-- Ø²Ø± Ø§Ù„Ù€ Follow/Unfollow -->
            <button mat-button class="follow-btn" (click)="toggleFollow()">
              {{ isFollowing ? 'Unfollow' : 'Follow' }}
            </button>
          </mat-card-subtitle>
        </div>
    
        <!-- Ø§Ù„ÙŠÙ…ÙŠÙ†: Ø§Ù„Ù…Ù†ÙŠÙˆ -->
        <div class="menu-wrapper">
          <app-action-menu
            [ownerId]="post.user_id"
            [currentUserId]="currentUserId"
            [type]="'post'"
            (edit)="goToEdit()"
            (delete)="onDeletePost()"
            (report)="onReportPost(post)"
            (hide)="onHidePost(post)"
          ></app-action-menu>
        </div>
      </div>
    </div>
    
    <mat-card-content>
      <div class="post-content">{{ post.content }}</div>

      <!-- Ø¯Ø¹Ù… Ø§Ù„Ù…ÙŠØ¯ÙŠØ§ -->
      <div class="media-section" *ngIf="post.media?.length > 0">
        <ng-container *ngFor="let file of post.media">
          <img *ngIf="isImage(file)" [src]="'http://localhost:8000/storage/' + file" class="media-preview" />
          <video *ngIf="isVideo(file)" [src]="'http://localhost:8000/storage/' + file" controls class="media-preview"></video>
          <audio *ngIf="isAudio(file)" [src]="'http://localhost:8000/storage/' + file" controls></audio>
          <a *ngIf="isDocument(file)" [href]="'http://localhost:8000/storage/' + file" target="_blank" class="doc-link">
            <mat-icon>insert_drive_file</mat-icon> View Document
          </a>
        </ng-container>
      </div>

      <!-- Ø²Ø± Ø§Ù„Ù€ Vote Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙˆÙ…Ø¨ÙˆÙ†Ù†Øª -->
      <app-vote-buttons
        [targetType]="'post'"
        [targetId]="post.id.toString()"
        [upvotes]="post.upvotes"
        [downvotes]="post.downvotes"
        [currentVote]="post.current_user_vote"
        (voteUpdated)="onVoteUpdated('post', post.id, $event)"
      ></app-vote-buttons>

      <!-- Ø²Ø± Copy Post -->
      <button mat-raised-button color="accent" (click)="copyPost(post)" class="copy-button">
        <mat-icon>content_copy</mat-icon> Copy Link
      </button>
    </mat-card-content>
  </mat-card>

  <!-- Comments Section -->
  <div class="comments-container">
    <h3>ðŸ’¬ Comments ({{ post.comments?.length }})</h3>

    <div class="comment-form">
      <mat-form-field appearance="outline" class="full-width">
        <textarea
          matInput
          [(ngModel)]="newComment"
          placeholder="Write a comment..."
          class="comment-input animate"
        ></textarea>
      </mat-form-field>
      <button mat-raised-button color="primary" (click)="addComment()" [disabled]="isAddingComment">
        {{ isAddingComment ? 'Adding...' : 'Add Comment' }}
      </button>
    </div>

    <mat-card *ngFor="let comment of visibleComments" class="comment-card">
      <div class="comment-header">
        <mat-card-content>
          <p>{{ comment.content }}</p>
          <div class="comment-meta">
            <small>{{ comment.user?.name }} Â· {{ comment.created_at | date:'short' }}</small>
          </div>
        </mat-card-content>
    
        <div class="menu-wrapper">
          <app-action-menu
            [ownerId]="comment.user_id"
            [currentUserId]="currentUserId"
            [type]="'comment'"
            (edit)="onEditComment(comment)"
            (delete)="onDeleteComment(comment)"
            (report)="onReportComment(comment)"
            (hide)="onHideComment(comment)"
          ></app-action-menu>
        </div>
      </div>
    
      <!-- Ø§Ù„ØªØµÙˆÙŠØª Ù„Ù„ÙƒÙˆÙ…Ù†Øª -->
      <app-vote-buttons
        [targetType]="'comment'"
        [targetId]="comment.id.toString()"
        [upvotes]="comment.upvotes"
        [downvotes]="comment.downvotes"
        [currentVote]="comment.current_user_vote"
        (voteUpdated)="onVoteUpdated('comment', comment.id, $event)"
      ></app-vote-buttons>
    </mat-card>

    <!-- Ø²Ø± Show More Comments -->
    <button *ngIf="post.comments?.length > visibleComments.length" mat-stroked-button color="accent" (click)="showMoreComments()">
      Show more comments
    </button>
  </div>
</div>