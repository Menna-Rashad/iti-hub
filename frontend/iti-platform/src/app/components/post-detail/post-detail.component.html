<div class="post-wrapper" *ngIf="post">
  <mat-card class="post-card">
    <div class="post-header-wrapper">
      <div class="post-header">
        <!-- ✅ اليسار: العنوان والتاريخ -->
        <div class="post-info">
          <mat-card-title class="post-title">{{ post.title }}</mat-card-title>
          <mat-card-subtitle class="post-meta">
            <span>{{ post.user?.name }}</span> · 
            <span>{{ post.created_at | date:'medium' }}</span>
          </mat-card-subtitle>
        </div>
    
        <!-- ✅ اليمين: المنيو -->
        <div class="menu-wrapper">
          <app-action-menu
            [ownerId]="post.user_id"
            [currentUserId]="currentUserId"
            [type]="'post'"
            (edit)="goToEdit()"
            (delete)="onDeletePost()"
            (report)="onReportPost(post)"
            (hide)="onHidePost(post)"
          ></app-action-menu>
        </div>
      </div>
    </div>
    
    

    <mat-card-content>
      <p class="post-content">{{ post.content }}</p>

      <!-- ✅ بدل الزرائر القديمة، استخدمنا الكمبوننت -->
      <app-vote-buttons
      [targetType]="'post'"
      [targetId]="post.id"
      [upvotes]="post.upvotes"
      [downvotes]="post.downvotes"
      [currentVote]="post.current_user_vote"
      (voteUpdated)="onVoteUpdated('post', post.id, $event)"
    ></app-vote-buttons>

      <!-- <button *ngIf="canEdit" (click)="goToEdit()" mat-stroked-button color="primary" class="edit-btn">
        ✏️ Edit Post
      </button> -->
    </mat-card-content>
  </mat-card>

  <!-- Comments -->
  <div class="comments-container">
    <h3>💬 Comments ({{ post.comments?.length }})</h3>

    <div class="comment-form">
      <mat-form-field appearance="outline" class="full-width">
        <textarea matInput [(ngModel)]="newComment" placeholder="Write a comment..."></textarea>
      </mat-form-field>
      <button mat-raised-button color="primary" (click)="addComment()">Add Comment</button>
    </div>

    <mat-card *ngFor="let comment of post.comments" class="comment-card">
      <div class="comment-header">
        <mat-card-content>
          <p>{{ comment.content }}</p>
          <div class="comment-meta">
            <small>{{ comment.user?.name }} · {{ comment.created_at | date:'short' }}</small>
          </div>
        </mat-card-content>
    
        <div class="menu-wrapper">
          <app-action-menu
            [ownerId]="comment.user_id"
            [currentUserId]="currentUserId"
            [type]="'comment'"
            (edit)="onEditComment(comment)"
            (delete)="onDeleteComment(comment)"
            (report)="onReportComment(comment)"
            (hide)="onHideComment(comment)"
          ></app-action-menu>
        </div>
      </div>
    
      <!-- التصويت -->
      <app-vote-buttons
        [targetType]="'comment'"
        [targetId]="comment.id"
        [upvotes]="comment.upvotes"
        [downvotes]="comment.downvotes"
        [currentVote]="comment.current_user_vote"
        (voteUpdated)="onVoteUpdated('comment', comment.id, $event)"
      ></app-vote-buttons>
    </mat-card>
    
  </div>
</div>
